name: Trading Bot Cron

on:
  schedule:
    # Run every 5 minutes during market hours (9:30 AM - 4:00 PM ET, Mon-Fri)
    # Also runs 24/7 for crypto (but less frequently on weekends)
    - cron: '*/5 9-16 * * 1-5'  # Weekday market hours
    - cron: '0 */2 * * 0,6'     # Weekends every 2 hours for crypto
    - cron: '0 0,4,8,12,16,20 * * 1-5' # Weekday off-hours every 4 hours
  workflow_dispatch: # Allow manual triggering

jobs:
  run-trading-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # Allow up to 30 minutes for full analysis

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install @upstash/redis

      - name: Run Trading Bot
        env:
          UPSTASH_REDIS_REST_URL: ${{ secrets.UPSTASH_REDIS_REST_URL }}
          UPSTASH_REDIS_REST_TOKEN: ${{ secrets.UPSTASH_REDIS_REST_TOKEN }}
          RUN_ONCE: 'true'
        run: node scripts/trading-bot.mjs
